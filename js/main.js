whitelisted = [
    '0x5a0Ff66c3bE0D74a6159Bd37bDbF485DCf27F25d',
'0x299E7F037BCBb6DeC4E01fe0cf8dC407b7D9eA56',
'0xFD3021AFE0Ff8C23b26713BB0c9D8540fdf8641B',
'0xAf81a3bD3c06A7e3B91af07F9fF67a43f5372E7d',
'0x9dA8699f75DECc0c1AE32Efab3A6Df04Caa70408',
'0xafE3b5D8e773f48fE17ec35F5eAb00C829B1a448',
'0x8E6A7B8Bc4f5bD0F37Ad5248EcC2794fC3c5149e',
'0x696FE7FD3764E3342DA271137687945242dD78c1',
'0xebE7040372306c0eB85dc8Fe80385B5826C9Aa87',
'0x97A6413311500CA4e4D0d4dbeFc0bf4E14E1a59B',
'0xcaB79c27968f5B80104E7B0e4fdbAf8641Fdc87c',
'0xae57349a0C3507b180DF0965a64b8879d2656560',
'0xf6E66B337AEaD72914D2dF514fC5ffD83Ee08392',
'0x16Ff1E95Bd156098050b4fe63d1505a76822E3E8',
'0x82F3d1A513069389de83004926E4c2a454B76594',
'0xc7F60C9100A43ff4b6676FcFd64a818318581A02',
'0x31F7f4Fe1bce32a99b99a616D81AFeFeC53F1FcB',
'0x69DC7BD9D94f5B836A9Cbadc503b4142CE457e36',
'0x9b8952ABA6f9Fb5B097Cd55f597511757f6937Ae',
'0x4d0F7f2D039c9D9D48C058F63015B8bd0577FA74',
'0x9FF49c0c85E35f23254Cb38c3513ba4241525E12',
'0xce364F5E9d2b59e4C99621723388a81e9ec65630',
'0xB272488eB1a6876040efe4750134E098A5d6df6A',
'0xeB9defC1Ef02510d676965bb5A398EF3B6D9c029',
'0xd9b2b1E441C9316Fc226dD335bd989Ce33611F6a',
'0xC4478f19E7f33E3A7f27c5430E68b38B2Df49524',
'0xFf62C5dc5a1526Ca867E8830f57e3EfAbd081CAe',
'0x05c2ec15242cceeaeecf7d78bd2985531e314849',
'0x39aDae38cEA67916Bb5AE2EEB91df0E5B3a6FFa4',
'0x54aAC0996423d06123a4E6Cc4e9d64aB92dB01c0',
'0x06400c5dA4cD2CC8892CaC8B660157D29a67598d',
'0xcB7b8A1DBE163cB3CCff2fbc4E55BcA30cDA300A',
'0xEcdd5F9f99F242382988a5769aA367C8F58F0c11',
'0x98d285e030Bb281cB4C12ea4F8CeD5980F76ee98',
'0xE1B02De7a94dbe6AEa56B7B88d72eBD495D5B68B',
'0xb969C12b2250c7E093bb7767923c64D290c4c5Ee',
'0x3731071fc66a3c435A66d078Da797c918025D38F',
'0x9f66EE3e703E8d584202179c2A3f49b9Ea1D9563',
'0xb6f904c71D25c484e7F70f17fF9B9B2B2465d59E',
'0xB3Eda1B48052a5f1A84F874EACADa414E9ecf2EC',
'0x47681CCce1494402699cfaF251808c3454d9D026',
'0x346B11990eA0568FFcf5FEdB94f225E90B9EE4A5',
'0x6215d21A09c7B805D9DdB3a68B6F91e5CF989097',
'0x461140839D9FC992f64EA0029F5890e711DdbaF2',
'0xe881439dC9260A539812AeF2E1aeD2767900B7Ac',
'0x43aBb52A608480dAb78199a3C17dF815eff8e182',
'0xaF25f948c1daa5Ed272345BbE355895F036eAa61',
'0x21815561eCA554054fa7Aba71e12682f50028CE6',
'0xDe9023464619639AC0E96961F5820Baa83FBea8e',
'0x5454ec29f90621f8A4BF1d2A7C73aF8B350E5147',
'0x4088e28521966678F9fdC41E540af7aa5d2F1D60',
'0x000736D66fb4E46163a39C3476793662444f2912',
'0x982083f8F2a15fd588685f6F0E7372c3642f3936',
'0x27d57Cd15feb468471dbE57Ab6288d73980f2D29',
'0x1C0Acaf31f038DAC65e0D4a9a1550AE75784aAdE',
'0x04a5e8C4A44780d115aDdA776B04Bcf1C4F3254E',
'0xee97cbf18fc41c068eb8afe67025353346c5fa02',
'0xc886D8B815a4e92AE0d2588a2119B83d287F8005',
'0x2D643Deb9adf607422E47369DFD53C0636C0B6e2',
'0xb09209db8a7E4077d10A8Aea927CcF65242CFd9c',
'0x6F1A18E399F8Da8B4019c24fbE755f0C96af61fB',
'0x8a0a677d64E5A428BDD04C2A96610010835396F6',
'0xC717063F994e7F9a73dC7d292a7E28e30Bb8913C',
'0x3CF3Fd7587902a47974db66Df866AfB28eAaB250',
'0x78E82147b7cB0a10D89BFC895259Dc8E4A1BFe30',
'0x95E484947586BAC21A826224b652a6B0b316FB12',
'0xcFfEDFa3Fef4f820E04a52ED01990F4E6229F565',
'0xDD7e2F3FEFE2db2Dc7594b36C7478F25568e180F',
'0xDF76A9775e6c0087da3248766980B35ca124c8ac',
'0x21D978b8e72976932a9a475fd0D75321B4BB43BA',
'0xB6572a572feCf87AdDab38588e387b2bDc9825Bb',
'0xaB029E65288AC38D8c48FbE4c556D063ec0A917f',
'0x26136e1f86Aa285f1D180f6206256dfD3E5Bad5e',
'0xe1E531116B298914311FE36795d3Fc5e68D7Aa88',
'0x5aAd82B2E7DE4c4081001548f6F1a80243Af5E91',
'0x6d31728aF03c007E490cC07e10bC4F42acE85845',
'0xc0734Dfc7f6F6CFDEC1D51669e85832615e6769c',
'0x5D3767CBb9fCFc15F0614d3C117A50Fbe12bc021',
'0x2104dD5ef0f0512B05838E2E3fDBeb91780ea5F3',
'0xdDe2a35BD92e4eeA7afca0776D1cf67243E9e9C3',
'0xcB24C806d1a4317E87336b163302Caf397A7f40b',
'0xD537bd1351DA10F92Cc0C9a7EE83831BCF7117D7',
'0xe2715250D414E8C46661DDa330a4CbE2798767bb',
'0x694Aa1578A3719355E251690e9CB72Ef1527F4bA',
'0xBfEFe33D8EF42894e109780416f8dC3807505f8f',
'0xB535411F0ed78bDC447d91A50120594672F596e6',
'0x0C68b5B2A22105174f9dc7030BF6324F8d889c02',
'0xCb5d9Cf80AC372A725adAbCe1b27D5FCE84FA386',
'0xD7646114Bd2f5953391aBdA4e1439DC5D193961c',
'0xB7d3922D242cb7248c29DdF1224E22a08875cac0',
'0x3f7d0f003c92a2e4B7985780326C26d9a79F5E3f',
'0xDa7b063B9e3D917f9899914809499Dc4Ec4620db',
'0xA6e1330f63E4946525FE096Bbb5B172701F33fC2',
'0x124926231b31Dc6C257C1321311eEB0F4520520e',
'0xf15ff189AB4741C1501AF7896956731A21404736',
'0x4D651265704fE4F38C903F3a2439B867901c8A88',
'0xF3f530D17EF7556e068f9585A144f7fFb275cefA',
'0xF7a9dcd54405b12113EF0Cd593002FC6c25B72B7',
'0xfe3De7f1b72f99b39CC1A67922a6a6fa645d0417',
'0x0F11C916516895F56F9937df3f6d16cD3e87927b',
'0x22af42DAb932D6628d1B37165952089A82E486d4',
'0x26848a9D7E69C020d2B8732A090Abc927147C8B0',
'0x10265E13dD219ab95212d6f168fd260Fba5e124A',
'0x8c2A36F85d92a3ece722fd14529E11390e2994D7',
'0xec7de3aa4e85F4b4219c2bE7c3da487460b2D3aA',
'0x34F39A005233164cf6aD9f87E355386eA4Cb5061',
'0x254dd957E31CCDeab0B28Ca67550eF998B74C540',
'0xeaeB42B770E662E653F0De9F4C6F1677102517b7',
'0xcd1C78538E3Cc0D2ceadd87b8124357d86566365',
'0x6B944B4496B7375aE9dFba6683838dA3B8618A4C',
'0xbBF01ba16F8cF7fA7a2BC516444FF343D4a064fD',
'0x2556927cB4A11a82C01192b99074F5Fa2E6eEcFa',
'0xE76972e4693a03008F42A37E69F981E7dCd6B4eC',
'0xAa55007545d661c7c30d5b0db13Cbec73fe418c9',
'0x2cB8bB6899fe0DB812e3a5b077bc545B9a4697DA',
'0x3bFb5E6d0b9E39d4B3B2a79725A047E6874f822d',
'0x587cb587074B62ea78EA7eBD35c4Dd956A6c7CC9',
'0x19214C421fC937024abe0bf1b7AeD2145F8C3a3c',
'0x59EC529c1d48f5a8DBDDb2cCFBAe13F6c6e77581',
'0x9cD2Fc42838173D1cf5609A3805629f023b031ea',
'0xA6e1330f63E4946525FE096Bbb5B172701F33fC2',
'0xC717063F994e7F9a73dC7d292a7E28e30Bb8913C',
'0xd148DE8c3990Ab5049D001838788b97546f6A8aA',
'0xD0547Bcf12e87658e2fCC6Ca5D0dB71A225078e2',
'0x2f902C2664adB96256249f3716405F68788a2775',
'0x60D48c64021740400053c58b9eC4Eb657c8C149f',
'0xeD14A3bCB766d9518323cEf2244c6f8338dEa281',
'0xbd3631B4D1d394Cec00a29D6b43230aC70ffc1C6',
'0x4474aFF745BdeaD9b72698f40922E57072410753',
'0x81Ea9DB63e4A750F092885b23014bC61a1D3f976',
'0x3318b8A2986676De36E1F2D1b9fC498b2DF0bd13',
'0xcfEa3Dc80c5010ABAf4c6fbB48A2F7f505359896',
'0xe096e231a21bd60060637ad06363e8ede5a7c4ff',
'0xc6dd295e5563B23dbb3FF72fb9A89890B1060331',
'0xb95748fAA4c08f12DAee4b082c60b7Ce846A87f8',
'0xd5EfEf227B0bC0Bd584aa7990Aa1bf6d83Db23Ff',
'0xEE9b89df4D6565a7C22B0787DB62e00B0df1f6c7',
'0x13A9c61B9f5760713FCa5b59a5700C3ADF9004E6',
'0x9BbB557e55AdFe4918A09d8A88ca8915034Ad168',
'0x28FfE7F5ae14E2222e857460814BfA1Ad60Fe67f',
'0xfB506b4341dE977726f685727Cb5F5416d642e0e',
'0x35C214a1d3f034c84Ed60782Ea97AeA82EcBe361',
'0xf54ddeAa51cc722d56170a28eF26bD01762A1517',
'0x9879B3EEC9C4e5fa8689B580B3C51276665523fb',
'0xAb44cC6162F223D8B0718BAc47212624dCAB51C4',
'0xf83015d3FE39769887717C6E5C8EAED0b3eDaFf9',
'0x6088BD86157475A9FDe846E1BB2B7c08005d1488',
'0x3e20646b7ecbC906AE4230B289A6573022e95513',
'0x129D898231225f73b805498FBaDA56e1214ecAe3',
'0xaC9bff8BA4571D0b5e514FE52De30B25bA2Ba172',
'0xF75D8CAb74F451b8e1d95CF720152d6Dc386b492',
'0x8A89f1BdC8E619fF37eC9D9C412117656618e37c',
'0x9683bD462B8cc50d62862De6737D49F00B801857',
'0xCbdf98B647C5d0E74719a690447c556D21bCe57e',
'0x564341719F3331250721A0a3227F2265B621B2f2',
'0x898787d3B04692c09761b17b056fb7686FBc8f41',
'0x46A5751ea9a0dC7858ac419f3B335Ba36fccf8e9',
'0x4614a4083bcAe05Ba7b95EfFc00C1e80d65994B6',
'0x3970F4fDbb18B546414116c88e0D561D25f3bD7b',
'0xAc36F13881B31b85eB43723Dd4AA6c3491391d8e',
'0x44d6Fc741188f7Fb811dB3138385FfF179e9252B',
'0x31fB0c3912F0170486cF1e2c006de428eBc9A735',
'0x6BB915681AA5a3A56BeD162bdB8Dd7EDA557E482',
'0x002465897F868A673232Cf44739e72D96dd31DF6'
]

window.userAddress = null;

const CONTRACT_ADDRESS = "0xFd7bFDc2147731c99E56Fa26D224dD9f23B6b73c";
const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"ApprovalCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"ApprovalQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"ApproveToCaller","type":"error"},{"inputs":[],"name":"BalanceQueryForZeroAddress","type":"error"},{"inputs":[],"name":"InvalidQueryRange","type":"error"},{"inputs":[],"name":"MintERC2309QuantityExceedsLimit","type":"error"},{"inputs":[],"name":"MintToZeroAddress","type":"error"},{"inputs":[],"name":"MintZeroQuantity","type":"error"},{"inputs":[],"name":"OwnerQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"OwnershipNotInitializedForExtraData","type":"error"},{"inputs":[],"name":"TransferCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"TransferFromIncorrectOwner","type":"error"},{"inputs":[],"name":"TransferToNonERC721ReceiverImplementer","type":"error"},{"inputs":[],"name":"TransferToZeroAddress","type":"error"},{"inputs":[],"name":"URIQueryForNonexistentToken","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"fromTokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"toTokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"ConsecutiveTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"burnedByOwner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"explicitOwnershipOf","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint64","name":"startTimestamp","type":"uint64"},{"internalType":"bool","name":"burned","type":"bool"},{"internalType":"uint24","name":"extraData","type":"uint24"}],"internalType":"struct IERC721A.TokenOwnership","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenIds","type":"uint256[]"}],"name":"explicitOwnershipsOf","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint64","name":"startTimestamp","type":"uint64"},{"internalType":"bool","name":"burned","type":"bool"},{"internalType":"uint24","name":"extraData","type":"uint24"}],"internalType":"struct IERC721A.TokenOwnership[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxPerWallet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"melt","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"merkleRoot","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"qty","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"qty","type":"uint256"}],"name":"mintAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"mintOpen","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mintedBySender","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_uri","type":"string"}],"name":"setBaseTokenURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_root","type":"bytes32"}],"name":"setMerkleRoot","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"toggleMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"toggleWhitelistMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"tokensOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"start","type":"uint256"},{"internalType":"uint256","name":"stop","type":"uint256"}],"name":"tokensOfOwnerIn","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBurned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"qty","type":"uint256"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"name":"whitelistMint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"wlMintOpen","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"}];
const defaultChain = "rinkeby";
const defaultChainId = 4;
const defaultChainName = "Rinkeby Testnet";
let wlMintOpen = false;
let mintOpen = false;
let isEligibleForWl = false;
let maxPerWallet = 0;

window.onload = async () => {
    // Init Web3 connected to ETH network
    if (window.ethereum) {
        window.web3 = new Web3(window.ethereum);
        window.web3.eth.defaultChain = defaultChain;
    } else {
        alert("No ETH brower extension detected.");
    }
};

window.ethereum.on("accountsChanged", async (accounts) => {
    if(!await checkChain()) {
        return;
    }
    if (accounts.length !== 0) {
        window.userAddress = accounts[0];
        await showAddress();
    }
});

window.ethereum.on('chainChanged', (_chainId) => window.location.reload());

// Use this function to turn a 42 character ETH address
// into an address like 0x345...12345
function truncateAddress(address) {
    if (!address) {
        return "";
    }
    return `${address.substr(0, 5)}...${address.substr(address.length - 5,address.length)}`;
}

// Display or remove the users know address on the frontend
async function showAddress() {
    if (!window.userAddress) {
        document.getElementById("connectButton").innerHTML = "";
        document.getElementById("mint").innerHTML = "Mint not active";
        document.getElementById("mint").classList.add("hidden");
        document.getElementById("mintText").innerHTML = "0 / 0";
        document.getElementById("mintText").classList.add("hidden");
        return false;
    }

    document.getElementById("connectButton").innerHTML = `${truncateAddress(window.userAddress)}`;
    document.getElementById("mint").classList.remove("hidden");
    document.getElementById("mintText").classList.remove("hidden");
    
    isEligibleForWl = false;
    window.proof = [];
    if(whitelisted.find(addr => addr.toLowerCase() == window.userAddress.toLowerCase()) !== undefined)
    {
        const leaves = whitelisted.map(addr => keccak256(addr.toLowerCase()));
        const tree = new MerkleTree(leaves, window.keccak256, { sort: true });
        const root = tree.getRoot().toString('hex');
        const leaf = keccak256(window.userAddress);
        proof = tree.getProof(leaf);
        console.log(tree.getHexRoot());
        //console.log(tree.verify(proof, leaf, root));
        window.proof = tree.getHexProof(leaf);  
        isEligibleForWl = true;    
    }
    

    const contract = new window.web3.eth.Contract(ABI,CONTRACT_ADDRESS);
    //console.log(contract);    
    totalSupply = await contract.methods.totalSupply().call({ from: window.userAddress });
    totalBurned = await contract.methods.totalBurned().call({ from: window.userAddress });
    totalSupply = parseInt(totalSupply) + parseInt(totalBurned);
    maxSupply = await contract.methods.maxSupply().call({ from: window.userAddress });
    maxSupply = parseInt(maxSupply);

    wlMintOpen = await contract.methods.wlMintOpen().call({ from: window.userAddress });
    mintOpen = await contract.methods.mintOpen().call({ from: window.userAddress });

    maxPerWallet = await contract.methods.maxPerWallet().call({ from: window.userAddress });
    maxPerWallet = parseInt(maxPerWallet);
    if((maxSupply - totalSupply) == 1) {
        maxPerWallet = 1;
    }
    
    mintedBySender = await contract.methods.mintedBySender().call({ from: window.userAddress });
    mintedBySender = parseInt(mintedBySender);

    maxPerWallet = Math.max(0,maxPerWallet - mintedBySender);

    document.getElementById("mintText").innerHTML = totalSupply + " / " + maxSupply;
    if(maxSupply <= totalSupply) {
        document.getElementById("mint").innerHTML = "Sold out!";
    } else if(maxPerWallet == 0) {
        document.getElementById("mint").innerHTML = "Already minted!";
    } else if (wlMintOpen && !isEligibleForWl) {
        document.getElementById("mint").innerHTML = "Not in whitelist";
    } else if (wlMintOpen || mintOpen) {
        document.getElementById("mint").innerHTML = "Mint " + maxPerWallet + " pile" + (maxPerWallet == 1?"":"s");
    }
    
}

// Login with Web3 via Metamasks window.ethereum library
async function loginWithEth() {
    if (window.web3) {
        try {
            if(!await checkChain()) {
                return;
            }
            // We use this since ethereum.enable() is deprecated. This method is not
            // available in Web3JS - so we call it directly from metamasks' library
            const selectedAccount = await window.ethereum
            .request({
                method: "eth_requestAccounts",
            })
            .then((accounts) => accounts[0])
            .catch(() => {
                throw Error("No account selected!");
            });
            window.userAddress = selectedAccount;
            await showAddress();
        } catch (error) {
            console.error(error);
        }
    } else {
        alert("No ETH brower extension detected.");
    }
}

async function mint() {
    if (!window.userAddress) {
        return;
    }
    if(!await checkChain()) {
        return;
    }
    if(maxPerWallet == 0) {
        return;
    }
    if(!(wlMintOpen&&isEligibleForWl) && !mintOpen) {
        return;
    }
    const contract = new window.web3.eth.Contract(ABI,CONTRACT_ADDRESS);
    if(wlMintOpen) {
        if(isEligibleForWl) {
            contract.methods.whitelistMint(maxPerWallet, window.proof).send({ from: window.userAddress });
        }        
    } else {
        if(mintOpen) {
            contract.methods.mint(maxPerWallet).send({ from: window.userAddress });        
        }
    }
}

async function checkChain() {
    chainOK = true;
    chainID = await window.web3.eth.net.getId();
    chainOK = chainID == defaultChainId;
    setErrorText(!chainOK, 'Change network to ' + defaultChainName);

    return chainOK;
}

function setErrorText(isError, errorText) {
    if(isError) {
        document.getElementById("errorText").innerHTML = errorText;        
    } else {
        document.getElementById("errorText").innerHTML = '&nbsp;';
    }
}